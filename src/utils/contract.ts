import { Uint256 } from 'web3';
import Web3 from './web3';
let web3: (typeof Web3) | undefined;
let contract: any | undefined;
declare global {
    interface Window {
      ethereum: any;
    }
  }

const contractAddress = '0x9EDf9C5aE83c4487cf22EDF7d084dDA78c3fd362';

const contractABI = [{"inputs":[],"name":"MAX_TREASURY_FEE","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"adminAddress","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"epoch","type":"uint256"}],"name":"betOnPlayerA","outputs":[],"stateMutability":"payable","type":"function"},{"inputs":[{"internalType":"uint256","name":"epoch","type":"uint256"}],"name":"betOnPlayerB","outputs":[],"stateMutability":"payable","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"},{"internalType":"uint256","name":"","type":"uint256"}],"name":"bets","outputs":[{"internalType":"enum HeadsUp.Position","name":"","type":"uint8"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"bufferSeconds","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"}],"name":"cardsDealt","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256[]","name":"epochs","type":"uint256[]"}],"name":"claim","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"epoch","type":"uint256"},{"internalType":"address","name":"user","type":"address"}],"name":"claimable","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"},{"internalType":"uint256","name":"","type":"uint256"}],"name":"communityCards","outputs":[{"internalType":"enum HeadsUp.Rank","name":"rank","type":"uint8"},{"internalType":"enum HeadsUp.Suit","name":"suit","type":"uint8"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"currentEpoch","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"epoch","type":"uint256"}],"name":"dealCommunityCards","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"epoch","type":"uint256"}],"name":"dealPlayerCards","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"epoch","type":"uint256"},{"internalType":"enum HeadsUp.Position","name":"position","type":"uint8"}],"name":"declareWinner","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"genesisStartOnce","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"epoch","type":"uint256"}],"name":"getCommunityCards","outputs":[{"components":[{"internalType":"enum HeadsUp.Rank","name":"rank","type":"uint8"},{"internalType":"enum HeadsUp.Suit","name":"suit","type":"uint8"}],"internalType":"struct HeadsUp.Card[5]","name":"_communityCards","type":"tuple[5]"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"epoch","type":"uint256"}],"name":"getPlayerCards","outputs":[{"components":[{"internalType":"enum HeadsUp.Rank","name":"rank","type":"uint8"},{"internalType":"enum HeadsUp.Suit","name":"suit","type":"uint8"}],"internalType":"struct HeadsUp.Card[2]","name":"_playerACards","type":"tuple[2]"},{"components":[{"internalType":"enum HeadsUp.Rank","name":"rank","type":"uint8"},{"internalType":"enum HeadsUp.Suit","name":"suit","type":"uint8"}],"internalType":"struct HeadsUp.Card[2]","name":"_playerBCards","type":"tuple[2]"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"user","type":"address"}],"name":"getUserRoundsLength","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"intervalSeconds","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"minEntry","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"operatorAddress","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"oracleLatestRoundId","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"oracleUpdateAllowance","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"},{"internalType":"uint256","name":"","type":"uint256"}],"name":"playerACards","outputs":[{"internalType":"enum HeadsUp.Rank","name":"rank","type":"uint8"},{"internalType":"enum HeadsUp.Suit","name":"suit","type":"uint8"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"},{"internalType":"uint256","name":"","type":"uint256"}],"name":"playerBCards","outputs":[{"internalType":"enum HeadsUp.Rank","name":"rank","type":"uint8"},{"internalType":"enum HeadsUp.Suit","name":"suit","type":"uint8"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"epoch","type":"uint256"},{"internalType":"address","name":"user","type":"address"}],"name":"refundable","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"treasuryAmount","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"treasuryFee","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"},{"internalType":"uint256","name":"","type":"uint256"}],"name":"userRounds","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"}],"name":"winner","outputs":[{"internalType":"enum HeadsUp.Position","name":"","type":"uint8"}],"stateMutability":"view","type":"function"}];

if (web3 && (window as any).ethereum) {
    contract = new web3.eth.Contract(contractABI, contractAddress);
}

export const getPlayerCardsFromContract = async (round: number) => {
    const cards = await contract.methods.getPlayerCards(round).call() as [number[], number[]];
    return cards.map((card: [number, number]) => ({
        rank: card[0],
        suit: card[1],
        image: `/images/${card[0]}_of_${card[1]}.png`,
    }));
};

export const getCommunityCardsFromContract = async () => {
    const cards = await contract.methods.getCommunityCards().call() as any[];
    return cards.map((card: any) => ({
        rank: card.rank,
        suit: card.suit,
        image: `/images/${card.rank}_of_${card.suit}.png`,
    }));
};
